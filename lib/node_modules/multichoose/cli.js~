#!/usr/bin/env node

var multichoose = require('multichoose')

if (process.argv.length < 3) {
  console.log('usage:', process.argv[0], '<k>', '[items]')
  console.log('sort the first file according to the order of the field [column] in the second')
  console.log('[file1] should have tab-delimited records, [file2] should be one-per-line')
  process.exit(1)
}


var file1 = process.argv[2]
var key = process.argv[3] - 1
var file2 = process.argv[4]
var input = []
var order = []
var output = []

function readDelim(filename, result, cb) {
  var parser = csvparse({delimiter:'\t'})
  var file = fs.createReadStream(filename)
  parser.on('readable', function(){
    while(record = parser.read()){
      result.push(record)
    }
  })
  file.on('end', function(){
    cb()
  })
  file.pipe(parser)
}

readDelim(file1, input, function() {
  readDelim(file2, order, function() {
    orderBy(input, key, order).map(function(row) {
      console.log(row.join('\t'))
    })
  })
})
